<div class="form-builder-container ">
  <!-- Header Section -->

  <header class="builder-header">
    <div class="container-fluid ">
      <div class="row mb-2">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">Template Builder</h3>
            <button
              class="btn btn-save"
              (click)="isEditMode ? updateTemplate() : saveTemplate()"
              [disabled]="isSaving"
            >
              <span *ngIf="!isSaving">
                <i class="bi bi-save me-2"></i
                >{{ isEditMode ? "Update" : "Save" }} Template
              </span>
              <span *ngIf="isSaving">
                <i class="bi bi-hourglass me-2"></i
                >{{ isEditMode ? "Updating..." : "Saving..." }}
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="row align-items-start g-1">
      <!-- Image Upload -->
      <div class="col-md-2 text-center align-start">
        <div class="position-relative profile-picture-container">
          <div
            class="profile-image-wrapper"
            (click)="openImageUrlModal(imageUrlModal)"
          >
            <img
              [src]="profilePicturePath || 'images/profiles.png'"
              class="mb-3 profile-image"
              width="120"
              height="120"
              (error)="handleImageError($event)"
            />
            <div class="upload-icon-overlay">
              <i class="bi bi-camera-fill"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <!-- Template Name -->
        <div class="col-md-10">
          <label class="form-label">Template Name</label>
          <input
            type="text"
            class="form-control form-name-input"
            placeholder="Enter template name"
            [(ngModel)]="formName"
          />
        </div>

        <!-- Document Type -->
        <div class="col-md-10">
          <label class="form-label">Document Type</label>
          <select class="form-control" [(ngModel)]="documentType">
            <option *ngFor="let type of documentTypes" [value]="type">
              {{ type }}
            </option>
          </select>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="builder-main-content container-fluid">
    <div class="row">
      <!-- Components Panel -->
      <aside class="components-panel col-md-2">
        <h5 class="components-title">
          <i class="bi bi-grid-3x3-gap me-2"></i>Form Components
        </h5>

        <div class="component-list">
          <div
            class="component-item"
            *ngFor="let component of components"
            draggable="true"
            (dragstart)="dragStart($event, component)"
          >
            <div class="component-icon">
              <i [class]="component.icon"></i>
            </div>
            <span class="component-name">{{ component.name }}</span>
          </div>
        </div>
      </aside>

      <!-- Form Canvas -->
      <main
        class="form-canvas col-md-7"
        droppable
        (dragover)="dragOver($event)"
        (drop)="drop($event)"
      >
        <div class="canvas-header">
          <h4>Form Canvas</h4>
          <p>Drag and drop components here to build your form</p>
        </div>

        <div class="form-preview">
          <h3 *ngIf="formName">{{ formName }}</h3>

          <!-- Dynamically added form components will appear here -->
          <div
            *ngFor="let item of formItems; let i = index"
            class="form-item"
            (click)="selectItem(i)"
            [class.selected]="selectedItemIndex === i"
          >
            <div class="form-item-content">
              <app-dynamicfield-component
                [config]="item"
              ></app-dynamicfield-component>
            </div>
            <div class="form-item-actions" *ngIf="selectedItemIndex === i">
              <button class="btn btn-sm btn-remove">
                <i class="bi bi-trash" (click)="removeItem(i)"></i>
              </button>
              <button class="btn btn-sm btn-settings ms-2">
                <i class="bi bi-gear"></i>
              </button>
            </div>
          </div>

          <div class="empty-state" *ngIf="formItems.length === 0">
            <i class="bi bi-inbox"></i>
            <p>Drop form components here to get started</p>
          </div>
        </div>
      </main>

      <!-- Properties Panel -->
      <aside class="properties-panel col-md-3">
        <h5 class="properties-title">
          <i class="bi bi-sliders me-2"></i>Properties
        </h5>

        <div class="properties-content" *ngIf="selectedItemIndex !== null">
          <h6>{{ formItems[selectedItemIndex].type }} Properties</h6>

          <div class="mb-3">
            <label class="form-label">Label</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="formItems[selectedItemIndex].label"
            />
          </div>
          <div class="mb-3">
            <label class="form-label">AI Prompt</label>
            <input
              type="textarea"
              class="form-control size-5"
              [(ngModel)]="formItems[selectedItemIndex].promt"
            />
          </div>

          <div
            class="mb-3"
            *ngIf="formItems[selectedItemIndex].type === 'text'"
          >
            <label class="form-label">Placeholder</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="formItems[selectedItemIndex].placeholder"
            />
          </div>

          <!-- More property fields based on component type -->
        </div>

        <div class="empty-state" *ngIf="selectedItemIndex === null">
          <i class="bi bi-node-plus"></i>
          <p>Select a component to edit its properties</p>
        </div>
      </aside>
    </div>
  </div>

  <!-- Footer -->
  <footer class="builder-footer"></footer>
  <!-- Add this at the bottom of your template, before the closing </div> -->
  <ng-template #imageUrlModal let-modal>
    <div class="modal-header">
      <h5 class="modal-title">Enter Image URL</h5>
      <button
        type="button"
        class="btn-close"
        (click)="modal.dismiss()"
        aria-label="Close"
      ></button>
    </div>
    <div class="modal-body">
      <div class="mb-3">
        <label class="form-label">Image URL</label>
        <input
          type="url"
          class="form-control"
          [(ngModel)]="profilePictureUrl"
          placeholder="https://example.com/image.jpg"
          name="profilePictureUrl"
        />
        <small class="text-muted"
          >Enter a direct image URL (must be publicly accessible)</small
        >
        <div *ngIf="errorMessage" class="text-danger mt-2">
          {{ errorMessage }}
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
        Cancel
      </button>
      <button
        type="button"
        class="btn btn-primary"
        (click)="updateProfilePicture()"
      >
        Update Image
      </button>
    </div>
  </ng-template>
</div>
